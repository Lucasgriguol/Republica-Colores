<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Pinturer√≠a ‚Äî Promociones</title>

  <!-- global CSS -->
  <link rel="stylesheet" href="styles.css">

  <!-- Scoped navbar/footer styles -->
  <style>
    .site-header {
      background: #fff;
      border-bottom: 1px solid rgba(16, 24, 40, 0.04);
      position: sticky;
      top: 0;
      z-index: 50;
      box-shadow: 0 1px 0 rgba(16, 24, 40, 0.02);
    }

    .site-header__inner {
      display: flex;
      align-items: center;
      gap: 18px;
      padding: 12px 20px;
      justify-content: space-between;
    }

    .site-brand .brand-link {
      color: var(--brand, #1565c0);
      font-weight: 800;
      font-size: 18px;
      text-decoration: none
    }

    .site-nav__list {
      display: flex;
      gap: 14px;
      list-style: none;
      margin: 0;
      padding: 0
    }

    .site-nav__list a {
      color: var(--muted, #6b7280);
      text-decoration: none;
      padding: 8px 10px;
      border-radius: 8px;
      font-weight: 600
    }

    .site-nav__list a:hover {
      color: var(--brand, #1565c0);
      background: rgba(21, 101, 192, 0.04)
    }

    .site-tools {
      display: flex;
      align-items: center;
      gap: 8px
    }

    .site-search {
      display: flex;
      gap: 8px;
      align-items: center
    }

    .site-search__input {
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #e9eef8;
      min-width: 180px
    }

    .site-search__btn {
      padding: 8px 10px;
      border-radius: 8px;
      border: 0;
      background: var(--brand, #1565c0);
      color: #fff;
      cursor: pointer
    }

    .site-cart {
      background: transparent;
      border: 0;
      font-size: 18px;
      cursor: pointer
    }

    .site-menu-toggle {
      display: none;
      background: transparent;
      border: 0;
      font-size: 20px;
      cursor: pointer;
      padding: 8px
    }

    .site-menu {
      background: #fff;
      border-top: 1px solid rgba(16, 24, 40, 0.04)
    }

    .site-menu__list {
      list-style: none;
      margin: 0;
      padding: 12px 0;
      display: flex;
      flex-direction: column;
      gap: 6px
    }

    .site-menu__list a {
      display: block;
      padding: 10px 0;
      color: var(--muted, #6b7280);
      text-decoration: none
    }

    .site-footer {
      background: linear-gradient(180deg, #f8fbff, #fff);
      border-top: 1px solid rgba(16, 24, 40, 0.03);
      padding: 20px 0;
      margin-top: 28px
    }

    .site-footer__inner {
      display: grid;
      grid-template-columns: 1fr 140px 180px 120px;
      gap: 18px;
      align-items: start;
      padding: 10px 20px
    }

    .site-footer h4 {
      margin: 0 0 8px 0
    }

    .site-footer ul {
      list-style: none;
      padding: 0;
      margin: 0
    }

    .site-footer a {
      color: var(--brand, #1565c0);
      text-decoration: none
    }

    .site-footer__bottom {
      border-top: 1px solid rgba(16, 24, 40, 0.02);
      padding: 10px 20px;
      margin-top: 12px;
      text-align: center
    }

    @media (max-width:900px) {
      .site-nav__list {
        display: none
      }

      .site-search__input {
        min-width: 120px
      }

      .site-menu-toggle {
        display: inline-block
      }

      .site-header__inner {
        padding: 10px 14px
      }

      .site-footer__inner {
        grid-template-columns: 1fr 1fr;
        gap: 12px
      }
    }

    @media (max-width:420px) {
      .site-footer__inner {
        grid-template-columns: 1fr;
        gap: 12px
      }
    }

    /* promos */
    .promos-page {
      padding: 24px 0
    }

    .promos-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 12px
    }

    .promo-card {
      background: #fff;
      padding: 14px;
      border-radius: 10px;
      box-shadow: 0 8px 24px rgba(16, 24, 40, 0.04);
      border: 1px solid rgba(16, 24, 40, 0.03);
      display: flex;
      flex-direction: column;
      gap: 8px
    }

    .promo-title {
      font-weight: 800;
      color: var(--brand);
      font-size: 18px
    }

    .promo-desc {
      color: var(--muted)
    }

    .promo-actions {
      display: flex;
      gap: 8px;
      margin-top: auto
    }

    .loading-center {
      text-align: center;
      padding: 30px;
      color: var(--muted);
    }

    .note-muted {
      color: var(--muted);
      font-size: 13px;
      margin-top: 8px;
    }
  </style>
</head>

<body>

  <!-- NAVBAR (mejorado) -->
  <header class="site-header" role="banner">
    <div class="site-header__inner container">
      <div class="site-brand">
        <a href="index.html" class="brand-link">Rep√∫blica Colores</a>
      </div>

      <nav class="site-nav" role="navigation" aria-label="Navegaci√≥n principal">
        <ul class="site-nav__list">
          <li><a href="index.html">Inicio</a></li>
          <li><a href="productos.html">Productos</a></li>
          <li><a href="promociones.html" aria-current="page">Promociones</a></li>
          <li><a href="reservas.html">Reservas</a></li>
        </ul>
      </nav>

      <div class="site-tools">
        <form class="site-search" role="search" onsubmit="event.preventDefault(); applyHeaderSearch();">
          <input id="globalSearch" class="site-search__input" type="search"
            placeholder="Buscar producto, marca o c√≥digo" aria-label="Buscar">
          <button type="button" class="site-search__btn" onclick="applyHeaderSearch()">Buscar</button>
        </form>

        <button class="site-reserve" onclick="location.href='reservas.html'">Reservas</button>

        <button class="site-menu-toggle" aria-label="Abrir men√∫" onclick="toggleSiteMenu()"
          aria-expanded="false">‚ò∞</button>
      </div>
    </div>

    <div id="site-menu" class="site-menu" hidden>
      <div class="container">
        <ul class="site-menu__list">
          <li><a href="index.html">Inicio</a></li>
          <li><a href="productos.html">Productos</a></li>
          <li><a href="promociones.html">Promociones</a></li>
          <li><a href="reservas.html">Reservas</a></li>
        </ul>
      </div>
    </div>
  </header>

  <!-- MAIN PROMOS -->
  <main class="container promos-page" id="promosMain">
    <h1>Promociones</h1>
    <p class="small">Promoci√≥n vigente: 3 cuotas sin inter√©s con todas las tarjetas.</p>

    <section id="promosSection" class="promos-grid" aria-live="polite">
      <div class="loading-center">Cargando promociones‚Ä¶</div>
    </section>
  </main>

  <!-- FOOTER (mejorado) -->
  <footer class="site-footer" role="contentinfo">
    <div class="site-footer__inner container">
      <div class="footer-col about">
        <a href="index.html" class="brand-link"><strong>Rep√∫blica Colores</strong></a>
        <p class="small muted">Soluciones en pinturas y terminaciones. Calidad y asesor√≠a desde hace m√°s de 20 a√±os.</p>
      </div>
      <div class="footer-col links">
        <h4>Enlaces</h4>
        <ul>
          <li><a href="productos.html">Productos</a></li>
          <li><a href="promociones.html">Promociones</a></li>
          <li><a href="index.html">Inicio</a></li>
        </ul>
      </div>
      <div class="footer-col contact">
        <h4>Contacto</h4>
        <p class="small muted">San Jer√≥nimo 3321 ‚Ä¢ C√≥rdoba, AR</p>
        <p class="small muted">Tel: +54 351 618 5138</p>
        <p class="small muted">Email: <a href="mailto:republica.colores@gmail.com">republica.colores@gmail.com</a></p>
      </div>
      <div class="footer-col social">
        <h4>S√≠guenos</h4>
        <div class="social-icons">
          <a href="#" aria-label="Facebook">üëç</a>
          <a href="#" aria-label="Instagram">üì∏</a>
        </div>
      </div>
    </div>

    <div class="site-footer__bottom container">
      <div class="small muted">¬© <span id="footerYear"></span> Rep√∫blica Colores ‚Äî Todos los derechos reservados</div>
    </div>
  </footer>

  <!-- Modal (condiciones) -->
  <div id="promoModalBack"
    style="display:none;position:fixed;inset:0;background:rgba(2,6,23,0.6);align-items:center;justify-content:center;z-index:220">
    <div id="promoModal" style="background:#fff;padding:20px;border-radius:10px;max-width:760px;width:94%;">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong id="modalTitle">Condiciones</strong>
        <button id="modalClose"
          style="background:#f3f6fb;border:1px solid #e6eef8;padding:8px;border-radius:8px;cursor:pointer">Cerrar</button>
      </div>
      <div id="modalBody" style="margin-top:12px;color:var(--muted);line-height:1.45"></div>
    </div>
  </div>

  <!-- Firebase + logic (mostramos primero las promos del code original) -->
  <script type="module">
    // Firebase v9 modular (se deja en caso de que haya promos en Firestore)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDPVbxfvJO-w-j6lGL-TEFeHNJRV7G1UTo",
      authDomain: "inventario-b8fc2.firebaseapp.com",
      projectId: "inventario-b8fc2",
      storageBucket: "inventario-b8fc2.firebasestorage.app",
      messagingSenderId: "184222469977",
      appId: "1:184222469977:web:83cc7bcc7116eb43494648"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- Las dos promos que ten√≠as en tu c√≥digo original (las dejo tal cual) ---
    const globalPromo = {
      id: 'global-3cuotas',
      title: '3 cuotas sin inter√©s con todas las tarjetas',
      description: '3 cuotas sin inter√©s con todas las tarjetas a determinadas promociones. Sujeto a verificaci√≥n de entidad emisora. No acumulable. Monto m√≠nimo: consultar en local.',
      terms: '3 cuotas sin inter√©s con todas las tarjetas adheridas. Sujeto a verificaci√≥n de entidad emisora. No acumulable.',
      acceptedPayments: 'Tarjetas, Efectivo y Transferencia Bancaria'
    };
    const secondPromo = {
      id: 'efectivo-transferencia',
      title: 'Pagos en efectivo y transferencias bancarias',
      description: 'Aceptamos pagos en efectivo y transferencias bancarias. Consult√° condiciones y plazos en local.',
      terms: 'Pagos en efectivo y transferencias bancarias aceptados. Confirmar disponibilidad y montos m√≠nimos en local.'
    };
    // -----------------------------------------------------------------------

    // helper: intenta leer colecciones de promos si las hubiera en Firestore (opcional)
    async function tryLoadCollections(names) {
      for (const name of names) {
        try {
          const col = collection(db, name);
          const snap = await getDocs(col);
          if (!snap.empty) return snap.docs.map(d => ({ id: d.id, ...d.data() }));
        } catch (e) { console.warn('err', name, e); }
      }
      return [];
    }

    // UI helpers
    function openModal(title, body) {
      const back = document.getElementById('promoModalBack');
      document.getElementById('modalTitle').textContent = title;
      const bodyEl = document.getElementById('modalBody');
      // body puede ser string o campo object
      bodyEl.textContent = (typeof body === 'string') ? body : (body.terms || body.description || JSON.stringify(body));
      back.style.display = 'flex';
    }
    function closeModal() {
      document.getElementById('promoModalBack').style.display = 'none';
    }

    function renderPromos(list) {
      const root = document.getElementById('promosSection');
      root.innerHTML = '';

      // Helper que crea la card (usamos la data tal cual)
      const showPromo = (p) => {
        const card = document.createElement('div');
        card.className = 'promo-card';
        const title = p.title || p.name || 'Promoci√≥n';
        const desc = p.description || p.desc || p.description || '';
        const terms = p.terms || p.condiciones || '';
        const accepted = p.acceptedPayments || p.accepted || '';

        card.innerHTML = `
          <div>
            <div class="promo-title">${escapeHtml(title)}</div>
            <div class="promo-desc">${escapeHtml(desc)}</div>
            <div class="note-muted">${escapeHtml(accepted)}</div>
          </div>
          <div class="promo-actions">
            <button class="btn btn-primary" type="button" onclick="openPromoModal_inline('${escapeJs(title)}','${escapeJs(terms || desc)}')">Ver condiciones</button>
          </div>
        `;
        root.appendChild(card);
      };

      // mostramos primero las promos "hardcoded" que ten√≠as en tu c√≥digo original
      showPromo(globalPromo);
      showPromo(secondPromo);

      // luego mostramos las que lleguen desde Firestore (si hay)
      if (list && list.length) {
        const note = document.createElement('div');
        note.className = 'note-muted';
        note.textContent = 'Promociones extra desde la base de datos:';
        root.appendChild(note);
        list.forEach(p => showPromo(p));
      } else {
        const note = document.createElement('div');
        note.className = 'note-muted';
        note.textContent = 'No hay promociones adicionales cargadas en Firestore.';
        root.appendChild(note);
      }
    }

    // utils escape
    function escapeHtml(s) { return String(s || '').replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;'); }
    function escapeJs(s) { return String(s || '').replace(/'/g, "\\\\'").replace(/"/g, '\\"'); }

    // wrapper para que el onclick pueda llamar openModal sin problemas de scope (inline)
    window.openPromoModal_inline = function (title, body) {
      openModal(title, body);
    };

    // b√∫squeda simple (activa el modal si encuentra coincidencia exacta en title) o alerta
    function doSearchPromo() {
      const q = document.getElementById('promSearch').value.trim().toLowerCase();
      if (!q) { alert('Ingres√° texto para buscar promociones'); return; }
      // buscamos en las promos hardcoded primero
      const all = [globalPromo, secondPromo];
      const found = all.find(p => (p.title || '').toLowerCase().includes(q) || (p.description || '').toLowerCase().includes(q));
      if (found) {
        openModal(found.title, found.terms || found.description);
        return;
      }
      alert('No se encontr√≥ la promoci√≥n buscada.');
    }

    // menu toggle (header)
    function toggleSiteMenu() {
      const menu = document.getElementById('site-menu');
      const btn = document.querySelector('.site-menu-toggle');
      if (!menu) return;
      const isHidden = menu.hasAttribute('hidden');
      if (isHidden) {
        menu.removeAttribute('hidden');
        btn.setAttribute('aria-expanded', 'true');
      } else {
        menu.setAttribute('hidden', '');
        btn.setAttribute('aria-expanded', 'false');
      }
    }

    // init
    (async function init() {
      document.getElementById('footerYear').textContent = new Date().getFullYear();
      // intentamos cargar promos desde Firestore (colecciones candidatas)
      const loaded = await tryLoadCollections(['promos', 'promotions', 'promociones']);
      renderPromos(loaded);
      // modal close handlers
      const modalClose = document.getElementById('modalClose');
      const modalBack = document.getElementById('promoModalBack');
      modalClose && modalClose.addEventListener('click', closeModal);
      modalBack && modalBack.addEventListener('click', e => { if (e.target === modalBack) closeModal(); });
      document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
    })();

    // expose doSearchPromo to global (for inline onclicks / tests)
    if (window) window.doSearchPromo = doSearchPromo;
  </script>

  <!-- small inline script to set year for footer if not set by module (fallback) -->
  <script>if (!document.getElementById('footerYear')) { /* nothing */ } else { document.getElementById('footerYear').textContent = new Date().getFullYear(); }</script>
</body>

</html>