<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pinturer√≠a ‚Äî Detalle de producto</title>

  <!-- Link al CSS global -->
  <link rel="stylesheet" href="styles.css">

  <!-- Scoped navbar/footer styles -->
  <style>
    .site-header {
      background: #fff;
      border-bottom: 1px solid rgba(16, 24, 40, 0.04);
      position: sticky;
      top: 0;
      z-index: 50;
      box-shadow: 0 1px 0 rgba(16, 24, 40, 0.02);
    }

    .site-header__inner {
      display: flex;
      align-items: center;
      gap: 18px;
      padding: 12px 20px;
      justify-content: space-between;
    }

    .site-brand .brand-link {
      color: var(--brand, #1565c0);
      font-weight: 800;
      font-size: 18px;
      text-decoration: none
    }

    .site-nav__list {
      display: flex;
      gap: 14px;
      list-style: none;
      margin: 0;
      padding: 0
    }

    .site-nav__list a {
      color: var(--muted, #6b7280);
      text-decoration: none;
      padding: 8px 10px;
      border-radius: 8px;
      font-weight: 600
    }

    .site-nav__list a:hover {
      color: var(--brand, #1565c0);
      background: rgba(21, 101, 192, 0.04)
    }

    .site-tools {
      display: flex;
      align-items: center;
      gap: 8px
    }

    .site-search {
      display: flex;
      gap: 8px;
      align-items: center
    }

    .site-search__input {
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #e9eef8;
      min-width: 180px
    }

    .site-search__btn {
      padding: 8px 10px;
      border-radius: 8px;
      border: 0;
      background: var(--brand, #1565c0);
      color: #fff;
      cursor: pointer
    }

    .site-cart {
      background: transparent;
      border: 0;
      font-size: 18px;
      cursor: pointer
    }

    .site-menu-toggle {
      display: none;
      background: transparent;
      border: 0;
      font-size: 20px;
      cursor: pointer;
      padding: 8px
    }

    .site-menu {
      background: #fff;
      border-top: 1px solid rgba(16, 24, 40, 0.04)
    }

    .site-footer {
      background: linear-gradient(180deg, #f8fbff, #fff);
      border-top: 1px solid rgba(16, 24, 40, 0.03);
      padding: 20px 0;
      margin-top: 28px
    }

    .site-footer__inner {
      display: grid;
      grid-template-columns: 1fr 140px 180px 120px;
      gap: 18px;
      align-items: start;
      padding: 10px 20px
    }

    .site-footer h4 {
      margin: 0 0 8px 0
    }

    .site-footer ul {
      list-style: none;
      padding: 0;
      margin: 0
    }

    .site-footer a {
      color: var(--brand, #1565c0);
      text-decoration: none
    }

    .site-footer__bottom {
      border-top: 1px solid rgba(16, 24, 40, 0.02);
      padding: 10px 20px;
      margin-top: 12px;
      text-align: center
    }

    @media (max-width:900px) {
      .site-nav__list {
        display: none
      }

      .site-search__input {
        min-width: 120px
      }

      .site-menu-toggle {
        display: inline-block
      }

      .site-header__inner {
        padding: 10px 14px
      }

      .site-footer__inner {
        grid-template-columns: 1fr 1fr;
        gap: 12px
      }
    }

    @media (max-width:420px) {
      .site-footer__inner {
        grid-template-columns: 1fr;
        gap: 12px
      }
    }
  </style>

  <!-- Scoped product styles -->
  <style>
    .product-page {
      padding: 28px 0;
    }

    .product-grid {
      display: grid;
      grid-template-columns: 480px 1fr;
      gap: 28px;
      align-items: start;
    }

    @media (max-width:980px) {
      .product-grid {
        grid-template-columns: 1fr;
      }
    }

    .product-media {
      background: #fff;
      padding: 14px;
      border-radius: 10px;
      box-shadow: 0 8px 24px rgba(16, 24, 40, 0.04);
      border: 1px solid rgba(16, 24, 40, 0.03);
    }

    .product-media img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      object-fit: contain;
      max-height: 420px;
      display: block;
    }

    .product-info h1 {
      margin: 0 0 10px 0;
      font-size: 26px;
      color: var(--brand);
    }

    .product-price {
      font-weight: 800;
      font-size: 20px;
      color: var(--brand);
      margin: 8px 0;
    }

    .product-meta {
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 12px;
    }

    .product-actions {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .btn-wide {
      padding: 10px 18px;
      border-radius: 10px;
      font-weight: 800;
    }

    .product-desc {
      margin-top: 16px;
      background: #fff;
      padding: 14px;
      border-radius: 10px;
      box-shadow: 0 8px 24px rgba(16, 24, 40, 0.03);
      border: 1px solid rgba(16, 24, 40, 0.02);
    }

    .loading-center {
      text-align: center;
      padding: 30px;
      color: var(--muted);
    }
  </style>
</head>

<body>

  <!-- NAVBAR -->
  <header class="site-header" role="banner">
    <div class="site-header__inner container">
      <div class="site-brand">
        <a href="index.html" class="brand-link" aria-label="Ir al inicio"><strong>Rep√∫blica Colores</strong></a>
      </div>

      <nav class="site-nav" role="navigation" aria-label="Navegaci√≥n principal">
        <ul class="site-nav__list">
          <li><a href="index.html">Inicio</a></li>
          <li><a href="productos.html">Productos</a></li>
          <li><a href="promociones.html">Promociones</a></li>
        </ul>
      </nav>

      <div class="site-tools">
        <form class="site-search" role="search" onsubmit="event.preventDefault(); doSearchIndex();">
          <input id="globalSearch" class="site-search__input" type="search"
            placeholder="Buscar producto, marca o c√≥digo" aria-label="Buscar">
          <button type="button" class="site-search__btn" onclick="doSearchIndex()">Buscar</button>
        </form>
        <button class="site-cart" aria-label="Ver carrito" onclick="alert('Carrito demo')">üõí</button>
        <button class="site-menu-toggle" aria-label="Abrir men√∫" onclick="toggleSiteMenu()"
          aria-expanded="false">‚ò∞</button>
      </div>
    </div>

    <div id="site-menu" class="site-menu" hidden>
      <div class="container">
        <ul class="site-menu__list">
          <li><a href="index.html">Inicio</a></li>
          <li><a href="productos.html">Productos</a></li>
          <li><a href="promociones.html">Promociones</a></li>
        </ul>
      </div>
    </div>
  </header>

  <!-- MAIN: detalle -->
  <main class="container product-page" id="productPage">
    <div id="productLoader" class="loading-center">Cargando producto‚Ä¶</div>

    <div class="product-grid" role="main" id="productGrid" style="display:none">
      <div class="product-media" id="mediaCol">
        <img id="productImage" src="https://via.placeholder.com/800x600?text=Producto" alt="Imagen del producto">
      </div>

      <div class="product-info">
        <h1 id="productTitle">Producto de ejemplo</h1>
        <div class="product-price" id="productPrice">$ 1.200</div>
        <div class="product-meta" id="productMeta">Marca: Demo ¬∑ Presentaci√≥n: 1 L</div>

        <div class="product-actions">
          <button class="btn btn-primary btn-wide" id="addBtn">Agregar al carrito</button>
          <button class="btn btn-ghost btn-wide" onclick="window.location.href='productos.html'">Volver al
            listado</button>
        </div>

        <div class="product-desc" id="productDesc">
          <h3>Descripci√≥n</h3>
          <p class="small muted">Descripci√≥n de ejemplo. Pintura acr√≠lica de alta calidad, buena cubertura y secado
            r√°pido. Recomendado para interiores.</p>

          <h4 style="margin-top:12px">Ficha t√©cnica</h4>
          <ul class="small muted" id="productSpecs">
            <li>Rendimiento: ~10 m¬≤ / litro</li>
            <li>Secado: 2 horas al tacto</li>
            <li>Aplicaci√≥n: rodillo / brocha / soplete</li>
          </ul>
        </div>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer" role="contentinfo">
    <div class="site-footer__inner container">
      <div class="footer-col about">
        <a href="index.html" class="brand-link"><strong>Rep√∫blica Colores</strong></a>
        <p class="small muted">Soluciones en pinturas y terminaciones. Calidad y asesor√≠a desde hace m√°s de 20 a√±os.</p>
      </div>
      <div class="footer-col links">
        <h4>Enlaces</h4>
        <ul>
          <li><a href="productos.html">Productos</a></li>
          <li><a href="promociones.html">Promociones</a></li>
          <li><a href="index.html">Inicio</a></li>
        </ul>
      </div>
      <div class="footer-col contact">
        <h4>Contacto</h4>
        <p class="small muted">San Jer√≥nimo 3321 ‚Ä¢ C√≥rdoba, AR</p>
        <p class="small muted">Tel: +54 351 618 5138</p>
        <p class="small muted">Email: <a href="mailto:republica.colores@gmail.com">republica.colores@gmail.com</a></p>
      </div>
      <div class="footer-col social">
        <h4>S√≠guenos</h4>
        <div class="social-icons">
          <a href="#" aria-label="Facebook">üëç</a>
          <a href="#" aria-label="Instagram">üì∏</a>
        </div>
      </div>
    </div>
    <div class="site-footer__bottom container">
      <div class="small muted">¬© <span id="footerYear"></span> Rep√∫blica Colores ‚Äî Todos los derechos reservados</div>
    </div>
  </footer>

  <!-- Firebase + logic: obtiene un producto por id -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDPVbxfvJO-w-j6lGL-TEFeHNJRV7G1UTo",
      authDomain: "inventario-b8fc2.firebaseapp.com",
      projectId: "inventario-b8fc2",
      storageBucket: "inventario-b8fc2.firebasestorage.app",
      messagingSenderId: "184222469977",
      appId: "1:184222469977:web:83cc7bcc7116eb43494648"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const COLLECTIONS = ['productos', 'products', 'items', 'inventario', 'productosListado'];

    const productGrid = document.getElementById('productGrid');
    const loader = document.getElementById('productLoader');

    // util: intenta leer doc por id en varias colecciones
    async function findProductById(id) {
      for (const name of COLLECTIONS) {
        try {
          const docRef = doc(db, name, id);
          const snap = await getDoc(docRef);
          if (snap && snap.exists()) {
            return { id: snap.id, ...snap.data(), _collection: name };
          }
        } catch (e) {
          console.warn('err find in', name, e);
        }
      }
      // fallback: try to search by a field 'slug' or 'code' across first collection(s)
      for (const name of COLLECTIONS) {
        try {
          const colRef = collection(db, name);
          const q = query(colRef, orderBy('name', 'asc'));
          const snap = await getDocs(q);
          if (!snap.empty) {
            for (const d of snap.docs) {
              const data = d.data();
              if (data.slug === id || d.id === id || (data.code && data.code === id)) {
                return { id: d.id, ...data, _collection: name };
              }
            }
          }
        } catch (e) { console.warn('err search in', name, e) }
      }
      return null;
    }

    function populateProductUI(p) {
      if (!p) return;
      const title = document.getElementById('productTitle');
      const priceEl = document.getElementById('productPrice');
      const meta = document.getElementById('productMeta');
      const img = document.getElementById('productImage');
      const descP = document.querySelector('#productDesc p');
      const specs = document.getElementById('productSpecs');

      title.textContent = p.name || p.nombre || p.title || 'Sin nombre';
      priceEl.textContent = (p.price || p.precio) == null ? 'Consultar' : ('$' + Number(p.price || p.precio).toLocaleString('es-AR'));
      meta.textContent = (p.brand || p.marca ? 'Marca: ' + (p.brand || p.marca) : '') + (p.presentation ? ' ¬∑ ' + p.presentation : '');
      const imageSrc = p.imageUrl || p.image || (p.images && p.images[0]) || 'https://via.placeholder.com/800x600?text=Sin+imagen';
      img.src = imageSrc;
      img.alt = title.textContent;
      descP.textContent = p.description || p.desc || p.descripcion || 'Descripci√≥n no disponible.';
      // specs (optional fields)
      specs.innerHTML = '';
      const specList = [];
      if (p.rendimiento) specList.push('Rendimiento: ' + p.rendimiento);
      if (p.drying) specList.push('Secado: ' + p.drying);
      if (p.application) specList.push('Aplicaci√≥n: ' + p.application);
      if (p.tips) specList.push(p.tips);
      if (specList.length === 0) {
        specs.innerHTML = '<li class="small muted">Ficha t√©cnica no disponible.</li>';
      } else {
        specList.forEach(s => {
          const li = document.createElement('li'); li.className = 'small muted'; li.textContent = s; specs.appendChild(li);
        });
      }
    }

    // header/helpers
    function toggleSiteMenu() {
      const menu = document.getElementById('site-menu');
      const btn = document.querySelector('.site-menu-toggle');
      if (!menu) return;
      const isHidden = menu.hasAttribute('hidden');
      if (isHidden) { menu.removeAttribute('hidden'); btn.setAttribute('aria-expanded', 'true'); }
      else { menu.setAttribute('hidden', ''); btn.setAttribute('aria-expanded', 'false'); }
    }
    function doSearchIndex() { var q = document.getElementById('globalSearch') ? document.getElementById('globalSearch').value.trim() : ''; if (!q) return location.href = 'productos.html'; location.href = 'productos.html?q=' + encodeURIComponent(q); }
    document.addEventListener('DOMContentLoaded', async function () {
      var el = document.getElementById('footerYear'); if (el) el.textContent = new Date().getFullYear();

      // obtener id de querystring
      const params = new URLSearchParams(location.search);
      const id = params.get('id');
      if (!id) {
        // si no hay id, mostrar mensaje y ocultar loader
        loader.textContent = 'No se indic√≥ producto (par√°metro ?id=).';
        return;
      }
      // buscar en Firestore
      loader.textContent = 'Buscando producto‚Ä¶';
      const product = await findProductById(id);
      if (product) {
        populateProductUI(product);
        loader.style.display = 'none';
        productGrid.style.display = '';
      } else {
        // fallback demo: si no lo encontramos, mostramos un demo o mensaje
        loader.innerHTML = '<div>No se encontr√≥ el producto. Mostrando ejemplo.</div>';
        const demo = {
          name: 'Pintura Acr√≠lica Interior (demo)',
          price: 1200,
          brand: 'Marca Demo',
          imageUrl: 'https://via.placeholder.com/800x600?text=Producto+Demo',
          description: 'Demostraci√≥n: este producto no se encontr√≥ en la base de datos.'
        };
        populateProductUI(demo);
        loader.style.display = 'none';
        productGrid.style.display = '';
      }
    });
  </script>
</body>

</html>