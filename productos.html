<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pinturer√≠a ‚Äî Productos</title>

  <!-- Mantener styles.css global -->
  <link rel="stylesheet" href="styles.css">

  <!-- Scoped navbar/footer styles -->
  <style>
    /* NAV / FOOTER (scoped) */
    .site-header {
      background: #fff;
      border-bottom: 1px solid rgba(16, 24, 40, 0.04);
      position: sticky;
      top: 0;
      z-index: 50;
      box-shadow: 0 1px 0 rgba(16, 24, 40, 0.02);
    }

    .site-header__inner {
      display: flex;
      align-items: center;
      gap: 18px;
      padding: 12px 20px;
      justify-content: space-between;
    }

    .site-brand .brand-link {
      color: var(--brand, #1565c0);
      font-weight: 800;
      font-size: 18px;
      text-decoration: none
    }

    .site-nav__list {
      display: flex;
      gap: 14px;
      list-style: none;
      margin: 0;
      padding: 0
    }

    .site-nav__list a {
      color: var(--muted, #6b7280);
      text-decoration: none;
      padding: 8px 10px;
      border-radius: 8px;
      font-weight: 600
    }

    .site-nav__list a:hover {
      color: var(--brand, #1565c0);
      background: rgba(21, 101, 192, 0.04)
    }

    .site-tools {
      display: flex;
      align-items: center;
      gap: 8px
    }

    .site-search {
      display: flex;
      gap: 8px;
      align-items: center
    }

    .site-search__input {
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #e9eef8;
      min-width: 180px
    }

    .site-search__btn {
      padding: 8px 10px;
      border-radius: 8px;
      border: 0;
      background: var(--brand, #1565c0);
      color: #fff;
      cursor: pointer
    }

    .site-reserve {
      background: transparent;
      border: 0;
      font-size: 16px;
      cursor: pointer;
      padding: 8px;
      color: var(--brand, #1565c0);
      font-weight: 700
    }

    .site-menu-toggle {
      display: none;
      background: transparent;
      border: 0;
      font-size: 20px;
      cursor: pointer;
      padding: 8px
    }

    .site-menu {
      background: #fff;
      border-top: 1px solid rgba(16, 24, 40, 0.04)
    }

    .site-menu__list {
      list-style: none;
      margin: 0;
      padding: 12px 0;
      display: flex;
      flex-direction: column;
      gap: 6px
    }

    .site-menu__list a {
      display: block;
      padding: 10px 0;
      color: var(--muted, #6b7280);
      text-decoration: none
    }

    .site-footer {
      background: linear-gradient(180deg, #f8fbff, #fff);
      border-top: 1px solid rgba(16, 24, 40, 0.03);
      padding: 20px 0;
      margin-top: 28px
    }

    .site-footer__inner {
      display: grid;
      grid-template-columns: 1fr 140px 180px 120px;
      gap: 18px;
      align-items: start;
      padding: 10px 20px
    }

    .site-footer h4 {
      margin: 0 0 8px 0
    }

    .site-footer ul {
      list-style: none;
      padding: 0;
      margin: 0
    }

    .site-footer a {
      color: var(--brand, #1565c0);
      text-decoration: none
    }

    .site-footer__bottom {
      border-top: 1px solid rgba(16, 24, 40, 0.02);
      padding: 10px 20px;
      margin-top: 12px;
      text-align: center
    }

    @media (max-width:900px) {
      .site-nav__list {
        display: none
      }

      .site-search__input {
        min-width: 120px
      }

      .site-menu-toggle {
        display: inline-block
      }

      .site-header__inner {
        padding: 10px 14px
      }

      .site-footer__inner {
        grid-template-columns: 1fr 1fr;
        gap: 12px
      }
    }

    @media (max-width:420px) {
      .site-footer__inner {
        grid-template-columns: 1fr;
        gap: 12px
      }
    }

    /* Productos: grid 4x */
    .products-page {
      padding: 24px 0
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      /* 4 columnas por fila en desktop */
      gap: 14px;
    }

    @media (max-width:1200px) {
      .products-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width:900px) {
      .products-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width:600px) {
      .products-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Card m√°s compacta */
    .product-card {
      border-radius: 8px;
      padding: 10px;
      background: #fff;
      box-shadow: 0 6px 18px rgba(16, 24, 40, 0.04);
      border: 1px solid rgba(16, 24, 40, 0.03);
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 200px;
    }

    /* Centrado de imagen y caja m√°s baja */
    .product-card .img-box {
      height: 120px;
      border-radius: 6px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fafafa;
    }

    .product-card .img-box img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
    }

    .product-card h3 {
      margin: 4px 0 0 0;
      font-size: 15px;
      line-height: 1.2;
    }

    .product-card .small.muted {
      font-size: 12px;
      color: var(--muted);
    }

    .product-card .price {
      font-weight: 800;
      color: var(--brand);
      font-size: 14px;
      margin-top: 6px;
    }

    .product-actions {
      display: flex;
      gap: 8px;
      margin-top: auto;
    }

    .product-actions .btn {
      padding: 6px 10px;
      font-size: 13px;
      border-radius: 8px;
    }

    .loading-center {
      text-align: center;
      padding: 30px;
      color: var(--muted);
    }

    /* Filters row small adjustments */
    .filters-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin: 12px 0;
      flex-wrap: wrap;
    }

    .filters-row input,
    .filters-row select {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #eef6fb;
      min-width: 160px;
    }

    .empty-msg {
      text-align: center;
      color: var(--muted);
      padding: 18px;
    }
  </style>
</head>

<body>

  <!-- NAVBAR -->
  <header class="site-header" role="banner">
    <div class="site-header__inner container">
      <div class="site-brand">
        <a href="index.html" class="brand-link" aria-label="Ir al inicio"><strong>Rep√∫blica Colores</strong></a>
      </div>

      <nav class="site-nav" role="navigation" aria-label="Navegaci√≥n principal">
        <ul class="site-nav__list">
          <li><a href="index.html">Inicio</a></li>
          <li><a href="productos.html" aria-current="page">Productos</a></li>
          <li><a href="promociones.html">Promociones</a></li>
          <li><a href="reservas.html">Reservas</a></li>
        </ul>
      </nav>

      <div class="site-tools">
        <form class="site-search" role="search" onsubmit="event.preventDefault(); doSearchIndex();">
          <input id="globalSearch" class="site-search__input" type="search"
            placeholder="Buscar producto, marca o c√≥digo" aria-label="Buscar">
          <button type="button" class="site-search__btn" onclick="doSearchIndex()">Buscar</button>
        </form>
        <button class="site-reserve" aria-label="Reservas" onclick="location.href='reservas.html'">Reservas</button>
        <button class="site-menu-toggle" aria-label="Abrir men√∫" onclick="toggleSiteMenu()"
          aria-expanded="false">‚ò∞</button>
      </div>
    </div>

    <div id="site-menu" class="site-menu" hidden>
      <div class="container">
        <ul class="site-menu__list">
          <li><a href="index.html">Inicio</a></li>
          <li><a href="productos.html">Productos</a></li>
          <li><a href="promociones.html">Promociones</a></li>
          <li><a href="reservas.html">Reservas</a></li>
        </ul>
      </div>
    </div>
  </header>

  <!-- CONTENIDO: Productos -->
  <main class="container products-page">
    <h1>Productos</h1>
    <p class="small muted">Listado de productos. Filtra por categor√≠a o busc√° por nombre (b√∫squeda en vivo mientras
      escrib√≠s).</p>

    <!-- Filters -->
    <div class="filters-row">
      <input id="filterName" placeholder="Buscar por nombre o marca" aria-label="Buscar por nombre" />
      <select id="filterCategory" aria-label="Filtrar por categor√≠a">
        <option value="">Todas las categor√≠as</option>
      </select>
      <button id="clearFilters" class="btn">Limpiar</button>
    </div>

    <div id="productsGrid" class="products-grid" aria-live="polite" aria-busy="true">
      <div class="loading-center">Cargando productos‚Ä¶</div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer" role="contentinfo">
    <div class="site-footer__inner container">
      <div class="footer-col about">
        <a href="index.html" class="brand-link"><strong>Rep√∫blica Colores</strong></a>
        <p class="small muted">Soluciones en pinturas y terminaciones. Calidad y asesor√≠a desde hace m√°s de 20 a√±os.</p>
      </div>
      <div class="footer-col links">
        <h4>Enlaces</h4>
        <ul>
          <li><a href="productos.html">Productos</a></li>
          <li><a href="promociones.html">Promociones</a></li>
          <li><a href="index.html">Inicio</a></li>
        </ul>
      </div>
      <div class="footer-col contact">
        <h4>Contacto</h4>
        <p class="small muted">San Jer√≥nimo 3321 ‚Ä¢ C√≥rdoba, AR</p>
        <p class="small muted">Tel: +54 351 618 5138</p>
        <p class="small muted">Email: <a href="mailto:republica.colores@gmail.com">republica.colores@gmail.com</a></p>
      </div>
      <div class="footer-col social">
        <h4>S√≠guenos</h4>
        <div class="social-icons">
          <a href="#" aria-label="Facebook">üëç</a>
          <a href="#" aria-label="Instagram">üì∏</a>
        </div>
      </div>
    </div>
    <div class="site-footer__bottom container">
      <div class="small muted">¬© <span id="footerYear"></span> Rep√∫blica Colores ‚Äî Todos los derechos reservados</div>
    </div>
  </footer>

  <!-- Firebase + logic: carga productos desde Firestore, categor√≠as, live search -->
  <script type="module">
    // Firebase v9 modular
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, getDocs, query } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDPVbxfvJO-w-j6lGL-TEFeHNJRV7G1UTo",
      authDomain: "inventario-b8fc2.firebaseapp.com",
      projectId: "inventario-b8fc2",
      storageBucket: "inventario-b8fc2.firebasestorage.app",
      messagingSenderId: "184222469977",
      appId: "1:184222469977:web:83cc7bcc7116eb43494648"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // colecciones candidatas
    const COLLECTIONS = ['productos', 'products', 'items', 'inventario', 'productosListado'];

    // elementos DOM
    const grid = document.getElementById('productsGrid');
    const filterName = document.getElementById('filterName');
    const filterCategory = document.getElementById('filterCategory');
    const clearBtn = document.getElementById('clearFilters');
    const headerSearch = document.getElementById('globalSearch');

    // almacen local de productos cargados
    let PRODUCTS = []; // array de objetos normalizados
    let CATEGORIES = new Set();

    // intenta leer varias colecciones y devuelve la primera que tenga docs
    async function tryLoadCollections(names) {
      for (const name of names) {
        try {
          const colRef = collection(db, name);
          const q = query(colRef);
          const snap = await getDocs(q);
          if (!snap.empty) {
            return { name, docs: snap.docs.map(d => ({ id: d.id, ...d.data() })) };
          }
        } catch (e) {
          console.warn('Error leyendo colecci√≥n', name, e);
        }
      }
      return null;
    }

    // helpers escapes
    function escapeHtml(s) { return String(s || '').replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;'); }
    function escapeJs(s) { return String(s || '').replace(/'/g, "\\'").replace(/"/g, '\\"'); }

    function productCardHTML(p) {
      const nombre = p.name || p.nombre || p.title || 'Sin nombre';
      const precio = (p.price || p.precio) == null ? 'Consultar' : ('$' + Number(p.price || p.precio).toLocaleString('es-AR'));
      const img = p.imageUrl || p.image || (p.images && p.images[0]) || 'https://via.placeholder.com/600x400?text=Sin+imagen';
      const brand = p.brand || p.marca || '';
      const category = p.category || p.categoria || p.type || p.categoryName || '';
      const id = encodeURIComponent(p.id || p._id || '');
      // data attributes for filtering
      const dataName = escapeHtml((nombre + ' ' + brand).toLowerCase());
      const dataMeta = escapeHtml((category + ' ' + brand).toLowerCase());
      return `
        <div class="product-card" data-name="${dataName}" data-meta="${dataMeta}">
          <div class="img-box"><img src="${img}" alt="${escapeHtml(nombre)}" loading="lazy" onerror="this.src='https://via.placeholder.com/600x400?text=Sin+imagen'"></div>
          <h3>${escapeHtml(nombre)}</h3>
          <div class="small muted">${escapeHtml(brand)}</div>
          <div class="price">${precio}</div>
          <div class="product-actions">
            <a class="btn btn-ghost" href="producto.html?id=${id}">Ver</a>
            <a class="btn" href="reservas.html?id=${id}" aria-label="Reservar ${escapeHtml(nombre)}">Reservar</a>
          </div>
        </div>
      `;
    }

    // render con array
    function renderProducts(list) {
      if (!grid) return;
      grid.innerHTML = '';
      if (!list || list.length === 0) {
        grid.innerHTML = '<div class="empty-msg">No se encontraron productos.</div>';
        return;
      }
      list.forEach(p => grid.insertAdjacentHTML('beforeend', productCardHTML(p)));
    }

    // llena select con categor√≠as detectadas
    function populateCategories() {
      const sorted = Array.from(CATEGORIES).filter(Boolean).sort((a, b) => a.localeCompare(b, 'es'));
      while (filterCategory.options.length > 1) filterCategory.remove(1);
      sorted.forEach(cat => {
        const opt = document.createElement('option'); opt.value = cat; opt.textContent = cat; filterCategory.appendChild(opt);
      });
    }

    // carga inicial de productos (intenta varias colecciones)
    async function loadProducts() {
      grid.setAttribute('aria-busy', 'true');
      grid.innerHTML = '<div class="loading-center">Cargando productos‚Ä¶</div>';
      const found = await tryLoadCollections(COLLECTIONS);
      if (!found) {
        PRODUCTS = [
          { id: 'ex1', name: 'Ejemplo 1', price: 1200, imageUrl: 'https://via.placeholder.com/600x400?text=Prod+1', brand: 'Marca A', category: 'Pinturas' },
          { id: 'ex2', name: 'Ejemplo 2', price: 2500, imageUrl: 'https://via.placeholder.com/600x400?text=Prod+2', brand: 'Marca B', category: 'Esmaltes' },
          { id: 'ex3', name: 'Ejemplo 3', price: 980, imageUrl: 'https://via.placeholder.com/600x400?text=Prod+3', brand: 'Marca C', category: 'Accesorios' }
        ];
      } else {
        PRODUCTS = found.docs.map(d => ({
          id: d.id,
          name: d.name || d.nombre || d.title || '',
          price: d.price || d.precio || null,
          imageUrl: d.imageUrl || d.image || (d.images && d.images[0]) || null,
          brand: d.brand || d.marca || '',
          category: d.category || d.categoria || d.type || d.categoryName || ''
        }));
      }
      CATEGORIES = new Set();
      PRODUCTS.forEach(p => {
        if (p.category) CATEGORIES.add(p.category);
      });
      populateCategories();
      const params = new URLSearchParams(location.search);
      const q = params.get('q') || '';
      if (q) {
        filterName.value = q;
        if (headerSearch) headerSearch.value = q;
      }
      renderProducts(PRODUCTS);
      grid.setAttribute('aria-busy', 'false');
    }

    // filtro (live)
    function applyFilters() {
      const q1 = (filterName.value || '').trim().toLowerCase();
      const q2 = (headerSearch && headerSearch.value) ? headerSearch.value.trim().toLowerCase() : '';
      const queryText = (q2.length > 0 ? q2 : q1);
      const cat = (filterCategory.value || '').toLowerCase();

      let filtered = PRODUCTS.filter(p => {
        const nameBrand = ((p.name || '') + ' ' + (p.brand || '')).toLowerCase();
        const meta = ((p.category || '') + ' ' + (p.brand || '')).toLowerCase();
        let okQuery = true;
        if (queryText) {
          okQuery = nameBrand.includes(queryText) || meta.includes(queryText);
        }
        let okCat = true;
        if (cat) {
          okCat = (p.category || '').toLowerCase() === cat;
        }
        return okQuery && okCat;
      });
      renderProducts(filtered);
    }

    // helpers for navbar/menu
    function toggleSiteMenu() {
      const menu = document.getElementById('site-menu');
      const btn = document.querySelector('.site-menu-toggle');
      if (!menu) return;
      const isHidden = menu.hasAttribute('hidden');
      if (isHidden) {
        menu.removeAttribute('hidden'); btn.setAttribute('aria-expanded', 'true');
      } else {
        menu.setAttribute('hidden', ''); btn.setAttribute('aria-expanded', 'false');
      }
    }

    function doSearchIndex() { var q = document.getElementById('globalSearch') ? document.getElementById('globalSearch').value.trim() : ''; if (!q) return location.href = 'productos.html'; location.href = 'productos.html?q=' + encodeURIComponent(q); }

    // attach events & init
    document.addEventListener('DOMContentLoaded', function () {
      var el = document.getElementById('footerYear'); if (el) el.textContent = new Date().getFullYear();

      loadProducts();

      if (filterName) filterName.addEventListener('input', () => { applyFilters(); });
      if (headerSearch) headerSearch.addEventListener('input', () => { applyFilters(); });
      if (filterCategory) filterCategory.addEventListener('change', () => { applyFilters(); });
      if (clearBtn) clearBtn.addEventListener('click', () => {
        filterName.value = '';
        if (headerSearch) headerSearch.value = '';
        filterCategory.value = '';
        applyFilters();
      });
    });
  </script>
</body>

</html>